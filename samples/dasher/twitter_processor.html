<!doctype html>
<html>
<head>
	<meta charset="utf-8">
    <title>Twitter Processor</title>
    <script>
    widget.config({
      "name": "twitter_processor",
      "version": "1.0.0",
      "title": "Twitter incoming feed processor",
      "desc": "Gets twitter stuff in and sends out summaries on a number of messaging streams",
      "url": "http://github.com/premasagar/sqwidget/plugins", // get the widget, via your taskbar
	  "ui" : "hostpage",
	   dependencies: [
		['messaging'],
		['twitter_stream'],
		],
    });
	</script>
	<script type="text/javascript" charset="utf-8">
		widget.ready(function() {
		    _('twitter processor ready');
		    widget.setTemplate('default');
		    var setSearchStream = widget.getSetting('set_search_stream');
		    var currentSearchStream = widget.getSetting('current_search_stream');
		    // set name of list
		    jQuery('p.info',container).html('Twitter processor ' + container.id + ' listening to search stream ' + setSearchStream);
		    // append messages received
		    plugins.messaging.listen(setSearchStream, function(event,stuff) {
		        jQuery(".message_list", container).append('<li>got msg ' + stuff.text + ' from ' + stuff.from + '</li>' );
		    });
		    // send a message to topic
            jQuery('form#searchform', container).submit(function() {
                var searchRes = jQuery('#search_field').val();
                plugins.twitter_stream.setSearchExpression(searchRes);
                plugins.messaging.send(currentSearchStream, {text:searchRes, from:container.id});  
                jQuery('#search_field').val('');
                return false;             
            })
		});
	</script>
	<script type="text/template" id="loading">
	    <p>Loading...<p>
	</script>
</head>

<body>
    <h2>Twitter processor</h2>
    <form id="searchform"><p><input type="text" name="search" value="" id="search_field"><input type="submit" name="submit" value="Search" id="submit"></p></form>
    <p class="info"></p>
    <p>Messages received</p>
    <ul class="message_list">        
    </ul>

</body>
</html>
